<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<html>
<head>

<title>MPATE-GE 2618 Final Project</title>

<link href="mfbasic.css" rel="stylesheet" type="text/css" />
</head>

<body>
<div id="top"></div>
<div id="container">
<div id="content">

<!--Do not edit anything above this-->

<h1>3D Sound Visualizer</h1>
<h2>Emmett Butler and David Coss</h2>

<h3>Summary</h3>
<p>This is a 3D visualizer for audio files. 

<h3>Usage</h3>
<pre>
	<b>Visualizer &lt;soundfile&gt; [-w hamming|hann|cosine] [-c] [-r]</b>
		soundfile : the file to be played
		-w : the windowing function for the waveform
		-c : enable flashing colours
		-r : enable mouse rotation
</pre>
<p><b>&lt;soundfile&gt;</b> must be a mono or stereo audio file. Supported formats include WAV, AIFF, and FLAC. For a list of file formats that are compatible with libsndfile but are untested with this program, see <a href="http://www.mega-nerd.com/libsndfile/">the libsndfile documentation</a>.
<p><b>-w</b> is an optional argument to specify a <a href="http://en.wikipedia.org/wiki/Hann_function">windowing function</a> for the waveform, giving the oscillator a "tapering" effect. Valid windowing functions are "hann", "hamming", and "cosine". Leaving out this flag or specifying an invalid window will result in no window being applied.

<h3>API</h3>

<h4>Starting and ending audio</h4>
<pre>
	bool startAudio(PaStream *stream, const char* filename, const char* windowname);

	void endAudio(PaStream *stream);
</pre>
<p>Handles all Portaudio and libsndfile functions necessary to begin or stop playback of the file with the specified file name. Example implementation:<p>
<pre>
	PaStream *stream;
	startAudio(PaStream *stream, "test.wav", "hamming");
</pre>

<h4>Reading audio</h4>
<p>All audio samples are stored in Packets. The packet structure is defined in Visualizer.h. Packet.frames is a 2D array of floats; the first dimension specifies the audio frame and the second dimension specifies the channel. Packet.free specifies whether the frames array is in read or write mode. If Packet.free is true, Packet.frames can be written to; if Packet.free is false, it can be read. averageAmp is the average amplitude of every sample in the Packet.</p>
<pre>
	/* Visualizer.h */
	#define PACKET_SIZE 256
	#define PAC_CHANNELS 2

	typedef struct _packet{
	    float frames[PACKET_SIZE][PAC_CHANNELS];
	    bool free;  // is this packet free to overwrite
	    int order;  // where in the sequence of samples is this packet
	    float averageAmp;
	} Packet;
</pre>

An array of Packets should be used in order to compensate for the framerate differences between the GL thread and the Portaudio thread. This is implemented in audio_helper.cpp and graphics_helper.cpp as <b>sharedBuffer</b>.

<h4>Window functions</h4>
<pre>
	/* audio_helper.h */
	typedef enum _WindowType {
	    Rect,
	    Hamming,
	    Hann,
	    Cosine
	} WindowType;

	float window(float sample, int index, int width, WindowType windowType);
</pre>
<pre>Note that Rect is equivalent to no window at all.</pre>

<!--Don't edit anything below here-->
</div>
<div id="footer">MPATE-GE 2618 C Programming for Music Technology Final Project</div>

</div>
</body>
</html>
